<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epoxy çŒæ¼¿å·¥ç¨‹å¯¦æˆ°èˆ‡ç‰©ç†äº’å‹•åŸ¹è¨“ (å®Œæ•´ç‰ˆ)</title>
   <style>
    /* å°èˆªåˆ—æ¨£å¼ (ç¢ºä¿å°èˆªåˆ—ç¾è§€å’ŒåŠŸèƒ½æ­£å¸¸) */
    body { margin: 0; font-family: "Microsoft JhengHei", "Segoe UI", Roboto, sans-serif; background-color: #f8f9fa; }
    .nav-tabs { 
        background: #004c97; /* æ·±è—èƒŒæ™¯ */
        padding: 15px 5px; /* ç¨å¾®æ¸›å°‘å·¦å³ padding */
        text-align: center; 
        display: flex;
        /* é—œéµä¿®æ”¹: ç§»é™¤ flex-wrap: wrap; ä»¥å¼·åˆ¶å–®æ’é¡¯ç¤º */
        /* flex-wrap: wrap; */ 
        justify-content: center;
        gap: 5px; /* ç¨å¾®æ¸›å°‘æŒ‰éˆ•é–“è· */
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        overflow-x: auto; /* ç¢ºä¿åœ¨çª„è¢å¹•ä¸Šå¯ä»¥æ©«å‘æ»¾å‹•æŸ¥çœ‹æ‰€æœ‰æŒ‰éˆ• */
    }
    .nav-btn { 
        color: white; 
        text-decoration: none; 
        padding: 10px 15px; /* ç¨å¾®æ¸›å°‘æŒ‰éˆ• padding */
        border: 1px solid rgba(255,255,255,0.3); 
        border-radius: 50px; 
        font-size: 0.9rem; 
        font-weight: bold;
        transition: all 0.3s;
        /* ç¢ºä¿æŒ‰éˆ•ä¸æœƒè¢«å£“ç¸®å¾—å¤ªå° */
        flex-shrink: 0;
    }
    .nav-btn:hover { background: rgba(255,255,255,0.2); }
    
    /* æ¨™ç¤ºæœ¬é ç‚º active */
    .nav-btn.active { 
        background: white; 
        color: #004c97; 
        font-weight: bold; 
        box-shadow: 0 0 8px rgba(255,255,255,0.5);
    }

    /* ç¢ºä¿ iframe ä½”æ»¿å‰©é¤˜ç©ºé–“ (å…¶ä»–æ¨£å¼ä¿æŒä¸è®Š) */
    .iframe-container { width: 100%; height: calc(100vh - 80px); /* 100vh æ¸›å»å°èˆªåˆ—é«˜åº¦ */ }
    iframe { width: 100%; height: 100%; border: none; }
</style>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* æ ¹è®Šæ•¸å®šç¾©ï¼šåŸºæ–¼åœ–ç‰‡æå–çš„é¡è‰² */
        :root {
            --color-primary: #004c97;         /* ä¸»è¦æ–‡å­—/æ¨™é¡Œ (æ·±è—ï¼Œä¾†è‡ª image_1.png) */
            --color-accent: #007bff;          /* ä¸»è‰²/äº®é» (äº®è—ï¼Œä¾†è‡ª image_0.png) */
            --color-epoxy-red: #e74c3c;       /* Epoxy æ¨¡æ“¬è‰² (é®®ç´…ï¼Œä¾†è‡ª image_0.png) */
            --color-accent-yellow: #f1c40f;   /* å¼·èª¿è‰²/è­¦å‘Š (äº®é»ƒï¼Œä¾†è‡ª image_0.png) */
            --color-accent-green: #28a745;    /* å¼·èª¿è‰²/æˆåŠŸ (æ·±ç¶ ï¼Œä¾†è‡ª image_0.png) */
            --color-bg-body: #f8f9fa;         /* é é¢èƒŒæ™¯ (æ·ºç°è—) */
            --color-text-body: #333;          /* ä¸€èˆ¬æ–‡å­—é¡è‰² */
            --color-card-bg: #ffffff;         /* å¡ç‰‡èƒŒæ™¯ */
            --color-success: var(--color-accent-green); /* æˆåŠŸç¶  */
            --color-warning: var(--color-accent-yellow); /* è­¦å‘Šé»ƒ */
            --color-danger: var(--color-epoxy-red);    /* å±éšªç´… */
            --color-code-bg: #ecf0f1;         /* ç¨‹å¼ç¢¼/è³‡è¨Šå¡ŠèƒŒæ™¯ */
            --color-shadow-light: rgba(0,0,0,0.05);
            --color-shadow-medium: rgba(0,0,0,0.1);
            --color-header-bg: #dbe9f4;       /* æ¨™é¡ŒèƒŒæ™¯æ·ºè— (ä¾†è‡ª image_1.png) */
        }

        /* åŸºç¤æ’ç‰ˆ */
        body {
            font-family: "Microsoft JhengHei", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg-body);
            color: var(--color-text-body);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container { max-width: 900px; margin: 0 auto; }

        /* é é¢æ¨™é ­ */
        header {
            text-align: center; margin-bottom: 30px; padding: 25px;
            background: linear-gradient(135deg, var(--color-primary), #003366); /* ä½¿ç”¨æ·±è—æ¼¸å±¤ */
            color: white; border-radius: 8px; box-shadow: 0 4px 10px var(--color-shadow-medium);
        }
        header h1 { margin: 0; font-size: 1.8rem; }

        /* å€å¡Šæ¨™ç±¤ (Tags) */
        .section-tag {
            display: inline-block; padding: 4px 12px; border-radius: 20px;
            font-size: 0.85rem; font-weight: bold; margin-bottom: 10px;
            text-transform: uppercase; box-shadow: 0 2px 4px var(--color-shadow-light);
        }
        .tag-field { background-color: #ffeaa7; color: #d35400; }
        .tag-design { background-color: #81ecec; color: #006266; }
        .tag-phy { background-color: var(--color-accent); color: white; }

        /* æ‰‹é¢¨ç´å€å¡Š (Accordion) */
        .accordion-item {
            background: var(--color-card-bg); margin-bottom: 15px; border-radius: 8px;
            box-shadow: 0 2px 5px var(--color-shadow-light); overflow: hidden;
            border-left: 5px solid var(--color-accent); /* å·¦å´å¼·èª¿è‰²æ”¹ç‚ºäº®è— */
        }
        .accordion-header {
            padding: 20px; cursor: pointer; display: flex; justify-content: space-between;
            align-items: center; background: #fff; transition: background 0.3s;
        }
        .accordion-header:hover { background-color: #f9f9f9; }
        .accordion-title { font-weight: bold; font-size: 1.1rem; color: var(--color-primary); }
        .icon { font-size: 1.2rem; transition: transform 0.3s; color: var(--color-accent); }
        .accordion-item.active .icon { transform: rotate(180deg); }
        .accordion-content {
            max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out;
            background-color: #fafafa; padding: 0 20px;
        }
        .accordion-item.active .accordion-content { padding: 20px; border-top: 1px solid #eee; }

        /* äº’å‹•å€åŸŸ */
        .interactive-area {
            background-color: #fff; border: 1px solid #ddd;
            padding: 20px; border-radius: 8px; margin-top: 20px;
            text-align: center; box-shadow: 0 2px 8px var(--color-shadow-light);
        }
        /* è¦†å¯« .interactive-area .controls button çš„æ¨£å¼ */
        .interactive-area .controls button {
            background-color: #f0f0f0;
            color: var(--color-primary);
            box-shadow: none;
            border: 1px solid #ccc;
            padding: 8px 16px; margin: 5px; cursor: pointer; border-radius: 4px;
            font-weight: bold; transition: background 0.2s, color 0.2s, box-shadow 0.2s; font-size: 0.9rem;
        }
        .interactive-area .controls button.active-tab { 
            background-color: var(--color-accent); /* é¸ä¸­ç‹€æ…‹æ”¹ç‚ºäº®è— */
            color: white;
            border-color: var(--color-accent);
            box-shadow: 0 2px 4px rgba(0,123,255,0.4); 
        }
        .interactive-area .controls button:hover { background-color: #e2e6ea; }
        
        /* --- SOP å€åŸŸå°ˆç”¨æ¨£å¼ --- */
        .accordion-content h4 {
            margin-top: 0;
            font-size: 1.2rem;
            color: var(--color-primary);
        }

        .step-controls {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 20px;
        }

        .step-controls button {
            flex-grow: 1;
            background-color: #f0f0f0;
            color: var(--color-primary);
            border: 1px solid #ccc;
            padding: 12px 10px;
            margin: 0;
            cursor: pointer;
            font-size: 1.0rem;
            font-weight: normal;
            transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
            border-radius: 0;
        }

        /* æ­¥é©ŸæŒ‰éˆ• - é¸ä¸­ç‹€æ…‹ (æ”¹ç‚ºäº®è—) */
        .step-controls button.active {
            background-color: var(--color-accent); /* äº®è— */
            color: white;
            font-weight: bold;
            border-color: var(--color-accent);
            box-shadow: 0 4px 6px rgba(0, 123, 255, 0.4);
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
        }

        .step-controls button:first-child { border-top-left-radius: 4px; }
        .step-controls button:last-child { border-top-right-radius: 4px; }

        /* æ­¥é©Ÿå…§å®¹å€å¡Š (ä¸Šæ–¹ç·šæ¢æ”¹ç‚ºäº®è—) */
        .step-content {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 0 0 8px 8px;
            border-top: 5px solid var(--color-accent); /* äº®è—ç·š */
            background-color: var(--color-card-bg);
        }

        .step-content .step-purpose {
            font-size: 1.05rem;
            font-weight: bold;
            color: var(--color-epoxy-red); /* ä½¿ç”¨é®®ç´… */
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }

        .step-details {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .step-details li {
            padding: 8px 0;
            font-size: 1rem;
            position: relative;
        }

        /* æ¨¡æ“¬åœ–ç‰‡ä¸­çš„ç®­é ­ (æ”¹ç‚ºäº®è—) */
        .step-details li::before {
            content: "â–¶";
            color: var(--color-accent); /* äº®è— */
            font-size: 0.9em;
            margin-right: 10px;
            line-height: 1;
            display: inline-block;
            vertical-align: middle;
        }

        .instruction {
            font-weight: bold;
            color: var(--color-primary);
            margin-bottom: 10px;
        }

        /* æº–å‚™æ¸…å–® (Checklist) */
        .checklist { list-style: none; padding: 0; text-align: left; }
        .checklist li { 
            background: white; padding: 10px; border: 1px solid #ddd; margin-bottom: 5px; border-radius: 4px;
            display: flex; align-items: center; cursor: pointer;
            transition: background 0.2s;
        }
        .checklist li:hover { background-color: #f0f0f0; }
        .checklist input[type="checkbox"] { transform: scale(1.5); margin-right: 15px; accent-color: var(--color-success); }
        .checklist-success { 
            display: none; background: #d4edda; color: #155724; padding: 15px; 
            font-weight: bold; margin-top: 10px; border-radius: 4px; border: 1px solid #c3e6cb;
        }

        /* --- è¡¨é¢ç‹€æ…‹æ¨¡æ“¬å™¨æ¨£å¼ (Surface State Simulator) --- */
        .surface-viewer {
            width: 100%; height: 200px; background: #ddd; 
            margin: 15px auto; border-radius: 6px; border: 2px solid #999;
            position: relative; overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .surface-viewer video { opacity: 0.95; }
        
        /* ç‹€æ…‹æè¿° (å·¦å´ç·šæ¢æ”¹ç‚ºé®®ç´…) */
        .state-description { 
            text-align: left; background: #f8f9fa; padding: 15px; 
            border-radius: 4px; margin-top: 10px; font-size: 0.9rem;
            border-left: 3px solid var(--color-epoxy-red); /* é®®ç´… */
        }
        
        /* --- çŒæ¼¿æ¨¡æ“¬å™¨æ¨£å¼ (Grouting Simulation) --- */
        .grout-sim-container {
            position: relative;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
            background-color: #fff;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #c0c0c0;
        }

        .legend-box {
            position: absolute;
            padding: 5px 10px;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.9);
            border-radius: 4px;
        }
        /* Inlet ä½¿ç”¨æ·±ç¶ ï¼ŒVent ä½¿ç”¨äº®é»ƒ */
        .legend-box.inlet { left: 5px; top: 40px; text-align: left; background-color: var(--color-accent-green); }
        .legend-box.vent { right: 5px; top: 40px; text-align: right; background-color: var(--color-accent-yellow); color: #333; text-shadow: none; }

        .layer-label {
            position: absolute;
            width: 100%;
            text-align: center;
            font-weight: 700;
            font-size: 18px;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.7); 
            z-index: 5;
        }
        .layer-label.baseplate { top: 50px; color: #ffffff; }
        .layer-label.concrete { top: 300px; color: #333; text-shadow: none; }
        
        /* --- æ•…éšœé‚Šç•Œè¡¨æ ¼ (Table Styles) --- */
        .diag-table { 
            width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.95rem; 
            background: white; border-radius: 6px; overflow: hidden; 
            box-shadow: 0 2px 4px var(--color-shadow-light); 
        }
        .diag-table th, .diag-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        /* è¡¨é ­èƒŒæ™¯æ”¹ç‚ºæ·ºè— */
        .diag-table th { background-color: var(--color-header-bg); color: var(--color-primary); font-weight: bold; }
        
        .diag-table .row-ok { background-color: #f0fff4; }
        .diag-table .row-ng { background-color: #fff0f0; }

        .diag-table .icon-ok { color: var(--color-success); font-size: 1.2em; font-weight: bold; }
        .diag-table .icon-ng { color: var(--color-danger); font-size: 1.2em; font-weight: bold; }

        /* --- K&M å½ˆç°§ç³»çµ±æ¨£å¼ --- */
        .spring-system { 
            height: 120px; position: relative; width: 100px; margin: 20px auto; 
            border-top: 4px solid #333; 
        }
        .spring { 
            width: 20px; margin: 0 auto; border: 1px solid #666; border-width: 0 2px; 
            background: repeating-linear-gradient(45deg, transparent, transparent 5px, #ccc 5px, #ccc 8px); 
            animation: spring-bounce 1s infinite ease-in-out; 
            position: absolute; left: 40px; 
        }
        /* è³ªé‡å¡Šæ”¹ç‚ºé®®ç´… */
        .mass-block { 
            width: 60px; height: 40px; background: var(--color-epoxy-red); color: white; 
            position: absolute; left: 20px; display: flex; align-items: center; 
            justify-content: center; animation: mass-bounce 1s infinite ease-in-out; 
            border-radius: 4px; font-weight: bold; border: 2px solid #c0392b; 
        }
        @keyframes spring-bounce { 0% { height: 30px; } 50% { height: 70px; } 100% { height: 30px; } }
        @keyframes mass-bounce { 0% { top: 30px; } 50% { top: 70px; } 100% { top: 30px; } }

        /* å…¬å¼ç´°ç¯€å±•é–‹ (Formula Dive) */
        details.formula-dive { 
            background-color: var(--color-code-bg); border: 1px dashed #aaa; 
            border-radius: 6px; margin: 15px 0; padding: 10px; 
        }
        details.formula-dive summary { 
            cursor: pointer; color: var(--color-accent); font-weight: bold; 
            outline: none; transition: color 0.2s; 
        }
        details.formula-dive summary:hover { color: #0056b3; }
        
        /* --- æŒ¯å‹•æ¨¡æ“¬å™¨æ¨£å¼ (Vibration Simulator) --- */
        .vib-sim-module { padding: 0; }
        .vib-sim-module h2 { color: var(--color-primary); }
        .vib-sim-module .scenarios { text-align: center; margin-bottom: 20px; }
        .vib-sim-module .btn { 
            padding: 10px 20px; margin: 0 10px; border: none; border-radius: 5px; 
            cursor: pointer; font-weight: bold; transition: 0.3s; color: white; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* æŒ‰éˆ•é¡è‰²èª¿æ•´ */
        .vib-sim-module .btn-epoxy { background-color: var(--color-accent); } /* äº®è— */
        .vib-sim-module .btn-iso { background-color: var(--color-accent-green); } /* æ·±ç¶  */
        .vib-sim-module .btn-danger { background-color: var(--color-danger); } /* é®®ç´… */
        .vib-sim-module .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        .vib-sim-module .controls-grid { 
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; 
            background: #eef2f3; padding: 20px; border-radius: 8px; margin-bottom: 20px; 
        }
        .vib-sim-module .control-group { 
            display: flex; flex-direction: column; 
            text-align: left;
        }
        .vib-sim-module input[type="range"] { 
            width: 100%; margin-bottom: 5px; 
            accent-color: var(--color-accent);
        }
        .vib-sim-module .value-display { 
            font-size: 1.2em; color: var(--color-accent); font-weight: bold; 
        }

        .vib-sim-module .dashboard { 
            display: flex; justify-content: space-around; margin-bottom: 20px; 
            padding: 15px; background: #f8f9fa; 
            border-left: 5px solid var(--color-accent); /* äº®è— */
            border-radius: 4px;
        }
        .vib-sim-module .stat-box { text-align: center; }
        .vib-sim-module .stat-title { font-size: 0.9em; color: #666; }
        .vib-sim-module .stat-value { font-size: 1.5em; font-weight: bold; }

        .vib-sim-module .chart-container { 
            position: relative; height: 350px; width: 100%; margin-top: 10px;
        }
        
        .vib-sim-module #statusMessage { 
            padding: 15px; text-align: center; font-weight: bold; 
            border-radius: 5px; margin-top: 10px; 
        }
        .vib-sim-module .status-safe { 
            background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; 
        }
        .vib-sim-module .status-danger { 
            background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; 
        }
        .vib-sim-module .status-iso { 
            background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; 
        }
        .vib-sim-module .formula { 
            text-align: center; color: #555; font-style: italic; margin-top: 5px; 
            font-size: 0.9em;
        }
    </style>
</head>

<body>

<div class="container">
    <header>
        <h1>Epoxy çŒæ¼¿å·¥ç¨‹å¯¦æˆ°æŒ‡å°</h1>
        <p> æ–½å·¥æŠ€å·§+Epoxyè¡¨é¢è§€å¯Ÿ+å»¶ä¼¸åˆ°è¨­è¨ˆæ€ç¶­é˜»å°¼æŒ¯å‹•åˆ†æ</p>
        
        <div class="nav-tabs">
            <a href="#" class="nav-btn active">ä¸€ã€äº’å‹•å¼</a>
            
            <a href="äºŒEpoxyçŒæ¼¿æ–½å·¥æŒ‡å—.html" class="nav-btn">äºŒã€EpoxyçŒæ¼¿æŒ‡å—</a>
            <a href="ä¸‰åˆ¤æ–·Epoxyèƒ½åŠ›é‚Šç•Œ.html" class="nav-btn">ä¸‰ã€Epoxyèƒ½åŠ›é‚Šç•Œ</a>
            <a href="å››é é›¢è‡ªç„¶é »ç‡.html" class="nav-btn">å››ã€é é›¢è‡ªç„¶é »ç‡</a>
            <a href="äº”EpoxyåŠŸæ•ˆ.html" class="nav-btn">äº”ã€EpoxyåŠŸæ•ˆ</a>
            <a href="å…­TIM12æœˆç°¡å ±.html" class="nav-btn">å…­ã€TIM12æœˆ</a>
            <a href="ä¸ƒå½±ç‰‡ç…§ç‰‡.html" class="nav-btn">ä¸ƒã€å½±ç‰‡ç…§ç‰‡</a>
            <a href="å…«å¿ƒå¾—.html" class="nav-btn">å…«ã€å¿ƒå¾—</a>
        </div>
    </header>
    
    <div class="section-tag tag-field" style="background-color: #fff3cd; color: #856404;">å„ªå…ˆç´šï¼šé«˜ (æ–½å·¥æµç¨‹)</div>
    <div class="accordion-item active">
        <div class="accordion-header">
            <div class="accordion-title">é›¶ã€æ–½å·¥æ­¥é©Ÿè©³è§£ (é»æ“Šæ­¥é©ŸæŸ¥çœ‹ç›®çš„èˆ‡ç´°ç¯€)</div>
            <div class="icon">â–¼</div>
        </div>
        <div class="accordion-content">
            <div class="interactive-area" style="text-align:left;">
                <p class="instruction">é»æ“Šä¸‹æ–¹æŒ‰éˆ•åˆ‡æ›æ­¥é©Ÿ</p>
                <div class="step-controls">
    <button onclick="renderStep('1')" data-step="1" class="active">1. åŸºåº§æº–å‚™</button>
    <button onclick="renderStep('2')" data-step="2">2. æ¼¿æ–™æ‹Œåˆ</button>
    <button onclick="renderStep('3')" data-step="3">3. çŒæ³¨ä½œæ¥­</button>
    <button onclick="renderStep('4')" data-step="4">4. é¤Šè­·è™•ç†</button>
</div>
<div id="step-content" class="step-content">
    </div>
            </div>
        </div>
    </div>

    <div class="section-tag tag-field" style="background-color: #fff3cd; color: #856404;">å„ªå…ˆç´šï¼šé«˜ (ç¾å ´æº–å‚™èˆ‡å¯¦æˆ°)</div>
    <div class="accordion-item active">
        <div class="accordion-header">
            <div class="accordion-title">ä¸€ã€æ ¸å¿ƒå·¥è—:æº–å‚™ç´°ç¯€èˆ‡å¯†é–‰ç©ºé–“æ’æ°£</div>
            <div class="icon">â–¼</div>
        </div>
        <div class="accordion-content">
            <div class="interactive-area" style="text-align:left; background-color: #fffbf0; border-color: #ffeeba;">
                <h3 style="margin-top:0; border-bottom:none; color:#856404;">ğŸ“‹ 1.1æ–½å·¥å‰é—œéµæª¢æŸ¥è¡¨</h3>
                <ul class="checklist" id="prep-checklist">
                    <li><label><input type="checkbox" onclick="checkChecklist()"> <strong>é€šæ°£å­” (Vents)ï¼š</strong> ç›´å¾‘è‡³å°‘ 12mmï¼Œè¨­ç½®æ–¼è§’è½åŠåŠ å¼·ç­‹å…©å´ã€‚</label></li>
                    <li><label><input type="checkbox" onclick="checkChecklist()"> <strong>æº«åº¦æ¢ä»¶ï¼š</strong> æ··å‡åœŸèˆ‡è¨­å‚™ç¶­æŒåœ¨ $18^\circ$â€“$30^\circ\text{C}$ï¼Œé¿å…é™½å…‰ç›´å°„ã€‚</label></li>
                    <li><label><input type="checkbox" onclick="checkChecklist()"> <strong>é›†æ–™ç®± (Head Box)ï¼š</strong> å¡åº¦ç´„ $45^\circ$ï¼Œåˆ©ç”¨é‡åŠ›æ“ å£“ã€‚</label></li>
                    <li><label><input type="checkbox" onclick="checkChecklist()"> <strong>æµå‹•è·¯å¾‘ï¼š</strong> æ¡é•·å¡é“è®“æ™‚é–“èˆ‡é‡åŠ›æ’æ°£ã€‚</label></li>
                </ul>
                <div id="checklist-msg" class="checklist-success">âœ… æº–å‚™å·¥ä½œå®Œæˆï¼å¯é–‹å§‹çŒæ¼¿ã€‚</div>
            </div>

            <h3>1.2 ç¾å ´åœ–é‘‘ï¼šèªè­˜ Epoxy è¡¨é¢ç‹€æ…‹</h3>
            <p>é€éè§€å¯Ÿè¡¨é¢ï¼Œåˆ¤æ–·çŒæ¼¿åæ‡‰éšæ®µæ˜¯å¦æ­£å¸¸ã€‚</p>
            <div class="interactive-area">
                <div class="controls">
                    <button onclick="showState('flow')" id="btn-flow" class="active-tab">A. æ”ªæ‹Œæ™‚æ…‹</button>
                    <button onclick="showState('bubble')" id="btn-bubble">B. æµå‹•æœŸ</button>
                    <button onclick="showState('cured')" id="btn-cured">C. æ’æ°£åæ‡‰</button>
                </div>
                
                <div class="surface-viewer" id="surface-display">
                    </div>

                <div id="state-text" class="state-description">
                    <strong>ğŸŒŠ ç‹€æ…‹ç‰¹å¾µï¼šæ³¢æµªæ¨é€² (Wave-like Motion)</strong><br>
                    æ¼¿æ¶²å‘ˆç¾ç´…è¤è‰²é»ç¨ ç‹€ï¼Œä¾é é‡åŠ›åƒã€Œå²©æ¼¿ã€ä¸€æ¨£æ²å‹•æ¨é€²ã€‚æ­¤æ™‚åˆ‡å‹¿å¾å°å‘çŒæ³¨ï¼Œä»¥å…å¤¾æ°£ã€‚<br>
                    <em>åƒç…§å½±åƒï¼š</em>
                </div>
            </div>

            <h3>1.3 çŒæ¼¿æ’æ°£æ¨¡æ“¬</h3>
            <div class="interactive-area">
                <div class="controls">
                    <button onclick="startSimulation('single')" style="background-color: var(--color-accent-green); color: white; border: none;">A. å–®å´çŒæ³¨ (æ­£ç¢º)</button>
                    <button onclick="startSimulation('double')" style="background-color: var(--color-epoxy-red); color: white; border: none;">B. é›™å´çŒæ³¨ (éŒ¯èª¤)</button>
                    <button onclick="resetSimulation()" style="background-color:#7f8c8d; color: white; border: none;">é‡ç½®</button>
                </div>
                
                <div id="simulation-container" class="grout-sim-container" style="max-width: 800px; margin: 20px auto;">
                    <canvas id="grout-simulation" width="800" height="400"></canvas>
                    
                    <div class="legend-box inlet">çŒæ¼¿å£ (Inlet)</div>
                    <div class="legend-box vent">æ’æ°£å­” (Vent)</div>
                    
                    <div class="layer-label baseplate">è¨­å‚™åº•åº§ (Baseplate)</div>
                    <div class="layer-label concrete">æ··å‡åœŸåŸºç¤ (Concrete)</div>
                </div>
                
                <div id="message" style="margin-top:10px; padding: 15px; font-weight:bold; color:#666; border: 2px solid #ddd; background-color: #ffffff; border-radius: 8px;">è«‹é¸æ“‡çŒæ¼¿æ–¹å¼</div>
            </div>
            <p><strong>ğŸ’¡ æª¢æŸ¥è¦é»ï¼š</strong> æª¢è¦–å­”çŒè‡³ 7~8 åˆ†æ»¿ï¼Œç¢ºèªå‘ˆç¾æ·±è‰²å…‰æ¾¤ä¸”ç„¡æ°£æ³¡å†’å‡ºï¼Œåœ¨é€²è¡Œå¤šæ¬¡è£œçŒè‡³æ»¿ã€‚</p>
        </div>
    </div>

    <div class="section-tag tag-phy" style="background-color: var(--color-accent);">å„ªå…ˆç´šï¼šä¸­ (æ±ºç­–å·¥å…·)</div>
    <div class="accordion-item">
        <div class="accordion-header">
            <div class="accordion-title">äºŒã€æ•…éšœè¨ºæ–·:Epoxy èƒ½åŠ›é‚Šç•ŒåŠƒåˆ†</div>
            <div class="icon">â–¼</div>
        </div>
        <div class="accordion-content">
            <h3>2.1 æ•…éšœé‚Šç•Œåˆ¤æ–·èˆ‡å£è¨£</h3>
            
            <div style="background-color:#fff3cd; border-left:4px solid var(--color-accent-yellow); padding:15px; margin:15px 0; border-radius: 4px;">
                <strong>ç¾å ´å£è¨£ï¼š</strong><br>
                ã€Œé¬†ã€è»Ÿã€æ­ªã€ç©º çš†å¯è£œï¼Œæ°£ã€æµã€é›»ã€å…§ ä¸å¯æ•‘ã€‚ã€
            </div>
            
            <table class="diag-table">
                <thead>
                    <tr>
                        <th>ç¾è±¡ (å£è¨£)</th>
                        <th>æœ¬è³ªåŸå›  (çµæ§‹/å®‰è£)</th>
                        <th>Epoxy åŠŸæ•ˆ</th>
                        <th>åŸç†èªªæ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="row-ok">
                        <td>é¬† (Looseness)</td>
                        <td>åœ°è…³èºæ “é¬†å‹•ã€é€£æ¥å‰›æ€§ä¸è¶³</td>
                        <td><span class="icon-ok">âœ… æœ‰æ•ˆ</span></td>
                        <td>å›ºçµå›ºå®šï¼Œæ¶ˆé™¤ç©ºéš™ï¼Œæå‡æ•´é«”é€£æ¥å‰›åº¦ã€‚</td>
                    </tr>
                    <tr class="row-ok">
                        <td>è»Ÿ (Soft Foot)</td>
                        <td>åŸºåº§å‰›æ€§ä¸è¶³æˆ–å¢Šç‰‡æ”¯æ’ä¸å¹³</td>
                        <td><span class="icon-ok">âœ… æœ‰æ•ˆ</span></td>
                        <td>æä¾› 100% æ”¯æ’é¢ï¼Œæé«˜ç³»çµ±å‰›åº¦ $K$ã€‚</td>
                    </tr>
                    <tr class="row-ok">
                        <td>ç©º (Void) / æ­ª</td>
                        <td>çŒæ¼¿å±¤ç©ºé¼“æˆ–è¨­å‚™åº•åº§ä¸å¹³æ•´</td>
                        <td><span class="icon-ok">âœ… æœ‰æ•ˆ</span></td>
                        <td>å®Œå…¨å¡«è£œç©ºéš™ï¼Œæ¢å¾©å—åŠ›é¢å‡å‹»åº¦ã€‚</td>
                    </tr>
                    <tr class="row-ng">
                        <td>æ°£ (Cavitation) / æµ (Flow)</td>
                        <td>æµé«”æ°£è•ã€æµé‡è„ˆå‹•æˆ–æ¶²é«”è¨­è¨ˆå•é¡Œ</td>
                        <td><span class="icon-ng">âŒ ç„¡æ•ˆ</span></td>
                        <td>å±¬æ–¼æµé«”å‹•åŠ›å­¸å•é¡Œï¼Œèˆ‡åŸºåº§ç„¡é—œã€‚</td>
                    </tr>
                    <tr class="row-ng">
                        <td>é›» (Electric) / å…§ (Internal)</td>
                        <td>é›»æ°£ä¸å¹³è¡¡ã€è½‰å­è»¸æ‰¿ç£¨æç­‰</td>
                        <td><span class="icon-ng">âŒ ç„¡æ•ˆ</span></td>
                        <td>å±¬æ–¼è¨­å‚™å…§éƒ¨æ©Ÿæ¢°/é›»æ°£æ•…éšœï¼Œéœ€ç¶­ä¿®è¨­å‚™æœ¬èº«ã€‚</td>
                    </tr>
                </tbody>
            </table>
            <p style="color:var(--color-primary); font-weight:bold; margin-top: 15px;">
                ç¸½çµï¼šEpoxy åƒ…èƒ½ä¿®æ­£çµæ§‹ï¼ˆåŸºç¤/åº•åº§ï¼‰ç›¸é—œçš„éœæ…‹å•é¡Œï¼Œä¸èƒ½è§£æ±ºè¨­å‚™å…§éƒ¨çš„å‹•æ…‹ã€æµé«”æˆ–é›»æ°£æ•…éšœã€‚
            </p>
        </div>
    </div>

    <div class="section-tag tag-phy" style="background-color: var(--color-accent);">å„ªå…ˆç´šï¼šä¸­ (è¨­è¨ˆæ€ç¶­)</div>
    <div class="accordion-item">
        <div class="accordion-header">
            <div class="accordion-title">ä¸‰ã€ç‰©ç†è¨­è¨ˆ:è³ªé‡ã€å‰›åº¦ã€é »ç‡æ¨¡æ“¬</div>
            <div class="icon">â–¼</div>
        </div>
        <div class="accordion-content">
            <h3>3.1 ç‚ºä»€éº¼åŸºåº§é‡é‡è¦æ˜¯è¨­å‚™çš„ 3~5 å€ï¼Ÿ</h3>
            <p>ç›®æ¨™ï¼šè®“è‡ªç„¶é »ç‡ $f_n$ é é›¢æ“ä½œé »ç‡ $f_{op}$ ($f_n \le 0.8 f_{op}$)ã€‚</p>
            
            <h3>3.2 äº’å‹•æ¨¡æ“¬ï¼šå‰›åº¦ K èˆ‡ è³ªé‡ M å¦‚ä½•æ”¹è®Šé »ç‡</h3>
            <p style="text-align:center; background:#f9f9f9; padding:10px; border-radius: 4px;">
                $$f_n = \frac{1}{2\pi}\sqrt{\frac{k}{M}}$$
            </p>
            
            <div class="interactive-area">
                <div style="display:flex; justify-content:space-around;">
                    <div class="control-group" style="width:45%;">
                        <label>å‰›åº¦ $k$ (Stiffness)</label>
                        <input type="range" id="k-slider" min="10" max="200" value="50" oninput="updateFreq()">
                    </div>
                    <div class="control-group" style="width:45%;">
                        <label>è³ªé‡ $M$ (Mass)</label>
                        <input type="range" id="m-slider" min="10" max="200" value="50" oninput="updateFreq()">
                    </div>
                </div>
                <div class="spring-system">
                    <div id="spring-vis" class="spring"></div>
                    <div id="mass-vis" class="mass-block">Mass</div>
                </div>
                <p>è‡ªç„¶é »ç‡ $\omega_n = $ <span id="freq-val" style="color:var(--color-epoxy-red); font-weight:bold;">1.00</span> rad/s</p>
            </div>

            <details class="formula-dive">
                <summary>ğŸ” é»æ“ŠæŸ¥çœ‹ï¼šå‰›åº¦å…¬å¼ $k = \frac{EA}{t}$ æ¨å°</summary>
                <div class="dive-content">
                    <p>æ ¹æ“šèƒ¡å…‹å®šå¾‹ $\sigma = E\varepsilon$ èˆ‡å½ˆç°§å®šç¾© $F = k\delta$ï¼Œå¯æ¨å°å‡º $k = \frac{EA}{t}$ã€‚</p>
                    <p>ç‰©ç†æ„ç¾©ï¼šåšåº¦ $t$ è¶Šè–„ï¼Œå‰›åº¦ $k$ è¶Šé«˜ã€‚</p>
                </div>
            </details>
        </div>
    </div>

    <div class="section-tag tag-design" style="background-color: #81ecec; color: #006266;">å„ªå…ˆç´šï¼šä¸­ (é€²éšç†è«–)</div>
    <div class="accordion-item">
        <div class="accordion-header">
            <div class="accordion-title">å››ã€èƒ½é‡å‚³éï¼šé˜»å°¼æŒ¯å‹•åˆ†æäº’å‹•æ¨¡æ“¬å™¨</div> <div class="icon">â–¼</div>
        </div>
        <div class="accordion-content">
            <div class="vib-sim-module">
                <h2>4.1æŒ¯å‹•å‚³éç‡èˆ‡ API è¨­è¨ˆäº’å‹•åˆ†æ</h2>
                <p style="text-align:center;">èª¿æ•´é »ç‡ä»¥è§€å¯Ÿ API æ¨™æº–å€é–“èˆ‡å‚³éç‡è®ŠåŒ–</p>

                <div class="scenarios">
                    <p>å¿«é€Ÿè¨­å®šæƒ…å¢ƒï¼š</p>
                    <button class="btn btn-epoxy" onclick="setScenario('epoxy')">æƒ…å¢ƒ Aï¼šEpoxy å‰›æ€§åŸºç¤ (é¿æŒ¯)</button>
                    <button class="btn btn-iso" onclick="setScenario('isolation')">æƒ…å¢ƒ Bï¼šå½ˆç°§éš”æŒ¯ (è»ŸåŸºç¤)</button>
                    <button class="btn btn-danger" onclick="setScenario('resonance')">å±éšªï¼šå…±æŒ¯å€</button>
                </div>

                <div class="controls-grid">
                    <div class="control-group">
                        <label>æ“ä½œé »ç‡ $f_{op}$ (Hz)</label>
                        <input type="range" id="fop" min="10" max="100" step="1" value="30">
                        <span class="value-display"><span id="fopVal">30</span> Hz</span>
                        <small>ä¾‹å¦‚: é¦¬é”è½‰é€Ÿ</small>
                    </div>
                    <div class="control-group">
                        <label>å›ºæœ‰é »ç‡ $f_n$ (Hz)</label>
                        <input type="range" id="fn" min="5" max="100" step="1" value="60">
                        <span class="value-display"><span id="fnVal">60</span> Hz</span>
                        <small>å–æ±ºæ–¼: è³ªé‡ & å‰›åº¦(Epoxy)</small>
                    </div>
                    <div class="control-group">
                        <label>é˜»å°¼æ¯” $\zeta$ (Damping)</label>
                        <input type="range" id="zeta" min="0.01" max="0.5" step="0.01" value="0.05">
                        <span class="value-display"><span id="zetaVal">0.05</span></span>
                        <small>Epoxyé˜»å°¼ç´„ 0.03-0.05</small>
                    </div>
                </div>

                <div class="dashboard">
                    <div class="stat-box">
                        <div class="stat-title">é »ç‡æ¯” ($r = f_{op} / f_n$)</div>
                        <div class="stat-value" id="rVal">0.50</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">å‚³éç‡ ($T$)</div>
                        <div class="stat-value" id="tVal">1.00</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">API è¦ç¯„ç‹€æ…‹</div>
                        <div class="stat-value" id="apiStatus">ç¬¦åˆ (å‰›æ€§)</div>
                    </div>
                </div>

                <div id="statusMessage" class="status-safe">
                    ç³»çµ±ç›®å‰è™•æ–¼å‰›æ€§åŸºç¤å€ã€‚æŒ¯å‹•åŠ›ç›´æ¥å‚³éä½†ä¸æ”¾å¤§ï¼Œé©åˆ Epoxy çŒæ¼¿è¨­è¨ˆã€‚
                </div>

                <div class="chart-container">
                    <canvas id="vibChart"></canvas>
                </div>
                <p class="formula">åœ–è¡¨ X è»¸ï¼šé »ç‡æ¯” $r = f_{op} / f_n$ &nbsp; | &nbsp; Y è»¸ï¼šå‚³éç‡ $T$</p>
            </div>
        </div>
    </div>

    <div style="text-align:center; margin-top:40px; color:#999; font-size:0.8rem;">
        TIM 12æœˆå·¥å‹™éƒ¨æ©Ÿæ¢°çµ„å·¥äº‹è™• | äº’å‹•å¼åŸ¹è¨“æ•™æ
    </div>

</div>

<script>
    
    // --- é›¶ã€SOP äº’å‹•é‚è¼¯ï¼šrenderStep å‡½å¼ (å·²æ›´æ–°) ---
function renderStep(step) {
    const contentDiv = document.getElementById('step-content');
    // ç²å–æ‰€æœ‰æ­¥é©Ÿæ§åˆ¶æŒ‰éˆ•
    const buttons = document.querySelectorAll('.step-controls button');

    // 1. æ­¥é©Ÿè©³æƒ…è³‡æ–™å®šç¾©
    const stepDetails = {
        '1': {
            title: 'æ­¥é©Ÿ 1ï¼šåŸºåº§æº–å‚™èˆ‡æ¸…æ½”',
            purpose: 'ç¢ºä¿çŒæ¼¿æ–™èˆ‡åŸºåº§å’Œåº•æ¿æœ‰æœ€ä½³çš„çµåˆåŠ›ã€‚',
            details: [
                'é‘¿é™¤æˆ–æ‰“æ¯›è¡¨é¢ï¼Œéœ²å‡ºæ–°é®®ã€ç²—ç³™çš„æ··å‡åœŸåŸºå±¤ã€‚',
                'æ¸…é™¤èˆŠæ··å‡åœŸåŸºåº§ä¸Šçš„æ‰€æœ‰æ²¹è„‚ã€å¡µåœŸã€é¬†å‹•æ°´æ³¥å¡Šã€‚',
                'åœ¨çŒæ¼¿å‰24å°æ™‚ï¼Œå°æ··å‡åœŸåŸºåº§ä¿æŒä¹¾ç‡¥ï¼Œä¸å¯æœ‰ç©æ°´ã€‚',
                'å»ºè­°ä»¥æ©Ÿæ¢°æ–¹å¼ç”¨æ‰‹æŒé¼“é¢¨æ©Ÿå¹ä¹¾ã€‚',
                'ç‚ºæ–¹ä¾¿æ‹†æ¨¡ï¼Œå¯å¡—å…©å±¤è Ÿè†æˆ–åŒ…è¦†èšä¹™çƒ¯è–„è†œã€‚'
            ]
        },
        '2': {
            title: 'æ­¥é©Ÿ 2ï¼šæ¼¿æ–™æ‹Œåˆ',
            purpose: 'ç¢ºä¿ææ–™å‡å‹»æ··åˆï¼Œé”åˆ°æœ€ä½³æµå‹•æ€§å’Œå¼·åº¦ã€‚',
            details: [
                'ä¾åŸå» æ¯”ä¾‹æ··åˆä¸»åŠ‘èˆ‡ç¡¬åŒ–åŠ‘åŠéª¨æã€‚', 
                'ä½¿ç”¨ä½é€Ÿé›»å‹•æ”ªæ‹Œå™¨å‡å‹»æ”ªæ‹Œä¸»åŠ‘èˆ‡ç¡¬åŒ–åŠ‘2åˆ†é˜ã€‚', 
                'å€’å…¥æ”ªæ‹Œå™¨åŠ å…¥éª¨æå‡å‹»æ”ªæ‹Œ1åˆ†é˜ã€‚', 
                'é¿å…æ”ªæ‹Œæ™‚é–“éé•·ç”¢ç”Ÿéå¤šç†±é‡æˆ–æ°£æ³¡ã€‚'
            ]
        },
        '3': {
            title: 'æ­¥é©Ÿ 3ï¼šçŒæ³¨ä½œæ¥­',
            purpose: 'ç¢ºä¿çŒæ¼¿å±¤å®Œæ•´ç„¡ç©ºéš™ (VOID)ï¼Œä¸¦å°‡ç©ºæ°£å®Œå…¨æ’å‡ºã€‚',
            details: [
                'æ¡ç”¨å–®å´ä½é€²é«˜æ’æ–¹å¼çŒæ³¨ï¼Œåˆ‡å‹¿é›™å‘çŒæ³¨ã€‚', 
                'çŒæ³¨é€Ÿåº¦éœ€ç¶­æŒç©©å®šï¼Œé¿å…éå¿«æˆ–éæ…¢ã€‚', 
                'æ³¨æ„çŒæ¼¿éç¨‹ä¸­æ’æ°£ç‹€æ³èˆ‡ç½®å¹³æ€§ç¾è±¡ã€‚'
            ]
        },
        '4': {
            title: 'æ­¥é©Ÿ 4ï¼šé¤Šè­·è™•ç†',
            purpose: 'ç¢ºä¿ç’°æ°§æ¨¹è„‚é”åˆ°è¨­è¨ˆå¼·åº¦å’Œè€ä¹…æ€§ã€‚',
            details: [
                'çŒæ³¨å¾Œæ‡‰éœç½®ï¼Œä¸å¯æ–æ™ƒæˆ–ç§»å‹•è¨­å‚™ã€‚', 
                'åœ¨æ¨™æº–ç’°å¢ƒæº«åº¦ (25Â°C) ä¸‹ï¼Œè¡¨é¢ç¡¬åŒ–ç´„ 6-8 å°æ™‚ï¼Œå®Œå…¨ç¡¬åŒ–éœ€2å¤©ã€‚', 
                'æ‹†æ¨¡èˆ‡é–‹æ”¾é‡è¼‰æ™‚é–“éœ€ä¾ç”¢å“è¦æ ¼å’Œæº«åº¦æ¢ä»¶èª¿æ•´ã€‚'
            ]
        }
    };

    // 2. åˆ‡æ›æŒ‰éˆ•æ¨£å¼
    buttons.forEach(btn => btn.classList.remove('active'));
    // ä½¿ç”¨ data-step æ‰¾åˆ°ç•¶å‰æ­¥é©ŸæŒ‰éˆ•
    const stepButton = document.querySelector(`.step-controls button[data-step="${step}"]`); 
    if(stepButton) stepButton.classList.add('active');


    // 3. å»ºç«‹ä¸¦æ’å…¥å…§å®¹ (ä½¿ç”¨æ–°çš„ class)
    const data = stepDetails[step];
    
    let htmlContent = `
        <h4 style="display:none;">${data.title}</h4> <p class="step-purpose">ç›®çš„ï¼š${data.purpose}</p>
        <ul class="step-details">`;
    data.details.forEach(detail => {
        htmlContent += `<li>${detail}</li>`;
    });
    htmlContent += `</ul>`;

    contentDiv.innerHTML = htmlContent;
}
window.renderStep = renderStep; // ç¢ºä¿å‡½å¼åœ¨å…¨åŸŸç¯„åœå…§å¯ç”¨
    
    // é è¨­æ¸²æŸ“æ­¥é©Ÿ 1
    renderStep('1'); 
    
    // --- ç¾å ´åœ–é‘‘ï¼šè¡¨é¢ç‹€æ…‹é‚è¼¯ (showState å‡½å¼) ---
    function showState(state) {
        const display = document.getElementById('surface-display');
        const text = document.getElementById('state-text');
        const btns = document.querySelectorAll('.interactive-area .controls button');

        // å½±ç‰‡æª”æ¡ˆåç¨±èˆ‡æè¿°å®šç¾©
        const stateData = {
            'flow': {
                videoFile: 'videos/flow.mp4', 
                desc: `<strong>âœ¨ ç‹€æ…‹ç‰¹å¾µï¼šæ”ªæ‹Œæ™‚æ…‹</strong><br>
                       ä¸»åŠ‘èˆ‡ç¡¬åŒ–åŠ‘æ··åˆå¾Œï¼ŒåŠ å…¥éª¨æä¸€é–‹å§‹è¡¨é¢æ°´æ°´çš„ï¼Œç•¶è·Ÿéª¨ææ··åˆå¾Œé–‹å§‹ä¸­é–“ä¹¾ä¹¾çš„å‘¨åœä¸€æ¨£æ°´æ°´çš„ï¼Œç•¶æ•´å€‹æ··åˆå‡å‹»æ™‚ç‹€æ…‹æœƒåƒå½±ç‰‡ç‹€æ³æ¿•æ½¤çš„æ„Ÿè¦ºå³å®Œæˆæ”ªæ‹Œã€‚`
            },
            'bubble': {
                videoFile: 'videos/bubble.mp4',
                desc: `<strong>ğŸŒŠ ç‹€æ…‹ç‰¹å¾µï¼šæµå‹•æœŸ</strong><br>
                       æ¼¿æ¶²å‘ˆç¾ç´…è¤è‰²é»ç¨ ç‹€ï¼Œä¾é è‡ªèº«é‡åŠ›åƒã€Œå²©æ¼¿ã€ä¸€æ¨£æ²å‹•æ¨é€²ã€‚æ­¤æ™‚**åˆ‡å‹¿**é›™å‘çŒæ³¨ï¼Œä»¥å…å¤¾æ°£ã€‚çŒæ³¨é€Ÿåº¦éœ€æ…¢ä¾æœ¬æ¡ˆè¨­å‚™æ©Ÿåº§å¤§å°ä¸Šåˆåƒ…èƒ½çŒæ³¨ä¸€å°ä¸‹åˆä¸€å°ã€‚`
            },
            'cured': {
                videoFile: 'videos/cured.mp4',
                desc: `<strong>ğŸŒ‹ ç‹€æ…‹ç‰¹å¾µï¼šæ’æ°£åæ‡‰</strong><br>
                       è¡¨é¢å‡ºç¾è¨±å¤šã€Œç«å±±å£ã€ç‹€çš„å°æ°£å­”ï¼Œå‘ˆç¾é¡ä¼¼æ©˜çš®çš„å‡¹å‡¸è³ªæ„Ÿã€‚é€™æ˜¯å…§éƒ¨ç©ºæ°£æ­£åœ¨çªç ´è¡¨é¢å¼µåŠ›çš„æ­£å¸¸ç¾è±¡ï¼Œ**æ‡‰éœç½®ç­‰å¾…**ï¼Œå¾…ç´„è«å®Œæˆæ’æ°£å¾Œå†å¤šæ¬¡è£œçŒè‡³æ»¿ï¼Œé¿å…ç©ºè°·ã€‚`
            }
        };
        const data = stateData[state];
        
        // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
        btns.forEach(b => b.classList.remove('active-tab'));
        document.getElementById(`btn-${state}`).classList.add('active-tab');
        
        // ä½¿ç”¨ <video> æ¨™ç±¤è¼‰å…¥æœ¬æ©Ÿæª”æ¡ˆ
        display.innerHTML = `
            <video 
                width="100%" 
                height="100%" 
                autoplay 
                muted 
                loop 
                controls 
                playsinline
                style="position:absolute; top:0; left:0; object-fit: cover;"
            >
                <source src="${data.videoFile}" type="video/mp4">
                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ HTML5 å½±ç‰‡æ’­æ”¾ã€‚
            </video>
        `;
        
        // æ›´æ–°æ–‡å­—æè¿°
        text.innerHTML = data.desc;
    }
    window.showState = showState;

    // --- 1.1 Checklist é‚è¼¯ ---
    function checkChecklist() {
        const checkboxes = document.querySelectorAll('#prep-checklist input[type="checkbox"]');
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        document.getElementById('checklist-msg').style.display = allChecked ? 'block' : 'none';
    }

    // --- 1.2 çŒæ¼¿æ’æ°£æ¨¡æ“¬ (Canvas ç¹ªåœ–é‚è¼¯) ---
    const canvas = document.getElementById('grout-simulation');
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;

    // æ¯”ä¾‹å®šç¾©
    const BASEPLATE_HEIGHT = 120;
    const GAP_HEIGHT = 150;       
    const CONCRETE_HEIGHT = H - BASEPLATE_HEIGHT - GAP_HEIGHT;
    
    const GROUT_Y_START = BASEPLATE_HEIGHT; 
    const GROUT_Y_END = BASEPLATE_HEIGHT + GAP_HEIGHT; 
    
    // æ“¬çœŸåŒ–é¡è‰²å®šç¾©
    const COLOR_BASEPLATE = '#5c636a';  
    const COLOR_CONCRETE_LIGHT = '#c0c0c0'; 
    const COLOR_CONCRETE_DARK = '#999999';  
    const COLOR_AIR = '#f7f7f7';        
    const COLOR_GROUT = '#8a3324';      
    const COLOR_GROUT_SHINE = '#a55041';
    const COLOR_TRAPPED_AIR = '#7dc1e4'; 
    const COLOR_TRAPPED_AIR_STROKE = '#2a68b2';
    const COLOR_INLET = '#28a745';      
    const COLOR_VENT = '#ffc107';       

    let animationFrameId = null;
    let progress = 0;
    let mode = null;
    const messageDisplay = document.getElementById('message');

    // ç¹ªè£½éœæ…‹å…ƒç´  (åº•åº§ã€æ··å‡åœŸã€ç©ºé–“)
    function drawStaticElements() {
        ctx.clearRect(0, 0, W, H);

        // 1. è¨­å‚™åº•åº§ (Baseplate)
        ctx.fillStyle = COLOR_BASEPLATE;
        ctx.fillRect(0, 0, W, BASEPLATE_HEIGHT);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.fillRect(0, 0, W, 10);
        ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
        ctx.fillRect(0, BASEPLATE_HEIGHT - 5, W, 5);

        // 2. çŒæ¼¿ç©ºé–“ (åˆå§‹ç‚ºç©ºæ°£)
        ctx.fillStyle = COLOR_AIR;
        ctx.fillRect(0, GROUT_Y_START, W, GAP_HEIGHT);

        // 3. æ··å‡åœŸåŸºç¤ (Concrete)
        ctx.fillStyle = COLOR_CONCRETE_LIGHT;
        ctx.fillRect(0, GROUT_Y_END, W, CONCRETE_HEIGHT);
        
        // æ··å‡åœŸç´‹ç†
        for (let i = 0; i < 1500; i++) {
            let x = Math.random() * W;
            let y = GROUT_Y_END + Math.random() * CONCRETE_HEIGHT;
            ctx.fillStyle = (Math.random() > 0.5) ? COLOR_CONCRETE_DARK : 'rgba(255,255,255,0.4)';
            ctx.fillRect(x, y, 1, 1);
        }

        // é‚Šç•Œç·š
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.strokeRect(0, GROUT_Y_START, W, GAP_HEIGHT);
        
        // ç¹ªè£½æ¼æ–—å½¢ç‹€
        drawFunnel(10, GROUT_Y_START, 'inlet');
        drawFunnel(W - 30, GROUT_Y_START, 'vent');

        // ç¹ªè£½åˆå§‹ç©ºæ°£æ¨™ç¤º
        drawTrappedAir(W / 2, GROUT_Y_START + (GAP_HEIGHT / 2), 30);
    }
    
    // ç¹ªè£½æ¼æ–—
    function drawFunnel(x, y, type) {
        ctx.beginPath();
        ctx.moveTo(x, y); 
        ctx.lineTo(x + 20, y); 
        ctx.lineTo(x + 15, y + 10);
        ctx.lineTo(x + 5, y + 10);
        ctx.closePath();
        
        ctx.fillStyle = (type === 'inlet') ? COLOR_INLET : COLOR_VENT;
        ctx.fill();
        
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        ctx.stroke();
    }
    
    // ç¹ªè£½è¢«å›°ä½çš„æ°£æ³¡
    function drawTrappedAir(x, y, radius) {
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fillStyle = COLOR_TRAPPED_AIR;
        ctx.fill();
        
        // æ°£æ³¡å…‰æ¾¤
        const gradient = ctx.createRadialGradient(x + radius / 3, y - radius / 3, 1, x, y, radius);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
        ctx.fillStyle = gradient;
        ctx.fill();
        
        ctx.strokeStyle = COLOR_TRAPPED_AIR_STROKE;
        ctx.lineWidth = 2;
        ctx.stroke();
        
        ctx.fillStyle = '#333';
        ctx.font = 'bold 16px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('Air', x, y);
    }

    // ç¹ªè£½çŒæ¼¿æµå‹•
    function drawGrout() {
        if (mode === 'single') {
            const groutWidth = W * progress;
            
            ctx.fillStyle = COLOR_GROUT;
            ctx.fillRect(0, GROUT_Y_START, groutWidth, GAP_HEIGHT);
            
            // æ¨¡æ“¬æ¶²é«”å‰æ²¿çš„åå…‰
            if (progress < 1.0) {
                 ctx.fillStyle = COLOR_GROUT_SHINE;
                 ctx.fillRect(groutWidth - 5, GROUT_Y_START, 5, GAP_HEIGHT);
            }
            
            // ç¹ªè£½æ°£æ³¡
            if (groutWidth < W / 2 + 30) {
                drawTrappedAir(W / 2, GROUT_Y_START + (GAP_HEIGHT / 2), 30);
            }

        } else if (mode === 'double') {
            const halfWidth = W / 2;
            const flowWidth = halfWidth * progress;
            const gapCenter = W / 2;
            const airRadius = 30;

            // ç¹ªè£½å·¦å³å…©å´çŒæ¼¿æµ
            ctx.fillStyle = COLOR_GROUT;
            ctx.fillRect(0, GROUT_Y_START, flowWidth, GAP_HEIGHT);
            ctx.fillRect(W - flowWidth, GROUT_Y_START, flowWidth, GAP_HEIGHT);
            
            // æ¨¡æ“¬æ¶²é«”å‰æ²¿çš„åå…‰
            if (progress < 1.0 && progress >= 0.1) {
                ctx.fillStyle = COLOR_GROUT_SHINE;
                ctx.fillRect(flowWidth - 5, GROUT_Y_START, 5, GAP_HEIGHT);
                ctx.fillRect(W - flowWidth, GROUT_Y_START, 5, GAP_HEIGHT);
            }
            
            // ç¹ªè£½è¢«å›°ä½çš„æ°£æ³¡
            if (progress >= 0.5) {
                const airX = gapCenter;
                const airY = GROUT_Y_START + (GAP_HEIGHT / 2);
                
                drawTrappedAir(airX, airY, airRadius);
                
                // è®“æ°£æ³¡å‘¨åœçš„çŒæ¼¿å±¤çœ‹èµ·ä¾†åƒå·²ç¶“åˆæ”
                if (progress > 0.6) {
                    ctx.fillStyle = COLOR_GROUT;
                    ctx.fillRect(flowWidth, GROUT_Y_START, gapCenter - flowWidth - airRadius, GAP_HEIGHT);
                    ctx.fillRect(gapCenter + airRadius, GROUT_Y_START, W - (gapCenter + airRadius) - flowWidth, GAP_HEIGHT);
                }
            } else {
                drawTrappedAir(W / 2, GROUT_Y_START + (GAP_HEIGHT / 2), airRadius);
            }
        }
        
        // é‡æ–°ç¹ªè£½æ¼æ–—å½¢ç‹€ï¼Œç¢ºä¿å…¶åœ¨é ‚å±¤
        drawFunnel(10, GROUT_Y_START, 'inlet');
        drawFunnel(W - 30, GROUT_Y_START, 'vent');
    }

    // å‹•ç•«å¾ªç’°
    function animate() {
        drawStaticElements();
        drawGrout();
        
        if (progress < 1.0) {
            progress += 0.005; 
            if (progress > 1.0) progress = 1.0;
            animationFrameId = requestAnimationFrame(animate);
        } else {
            displayResult();
        }
    }

    // é‡ç½®æ¨¡æ“¬
    function resetSimulation() {
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
        }
        progress = 0;
        mode = null;
        drawStaticElements();
        messageDisplay.textContent = 'è«‹é¸æ“‡çŒæ¼¿æ–¹å¼';
        messageDisplay.style.color = '#333';
        messageDisplay.style.border = '2px solid #ddd';
    }

    // å•Ÿå‹•æ¨¡æ“¬
    function startSimulation(newMode) {
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
        }
        resetSimulation();
        mode = newMode;
        animate();
    }
    
    // é¡¯ç¤ºçµæœ
    function displayResult() {
        if (mode === 'single') {
            messageDisplay.textContent = 'âœ… å–®å´çŒæ³¨æˆåŠŸï¼çŒæ¼¿å¯†å¯¦ï¼Œç©ºæ°£æœ‰æ•ˆæ’å‡ºã€‚';
            messageDisplay.style.color = '#006400';
            messageDisplay.style.border = '2px solid #28a745'; 
        } else if (mode === 'double') {
            messageDisplay.textContent = 'âŒ é›™å´çŒæ³¨éŒ¯èª¤ï¼ç©ºæ°£åœ¨ä¸­é–“è¢«çŒæ¼¿æ–™å°é–‰æ•æ‰ï¼Œé€ æˆç©ºéš™ã€‚';
            messageDisplay.style.color = '#a83c3c';
            messageDisplay.style.border = '2px solid #cc4949'; 
        }
    }
    
    // --- 3.2 K&M äº’å‹•é‚è¼¯ ---
    function updateFreq() {
        const k = parseInt(document.getElementById('k-slider').value);
        const m = parseInt(document.getElementById('m-slider').value);
        // è‡ªç„¶é »ç‡ (è§’é »ç‡ rad/s)
        const wn = Math.sqrt(k/m); 
        document.getElementById('freq-val').innerText = wn.toFixed(2);
        
        // æ›´æ–°å‹•ç•«é€Ÿåº¦ (é€±æœŸ = 2Ï€/Ï‰n)
        const dur = (2 * Math.PI) / wn;
        document.getElementById('spring-vis').style.animationDuration = dur + 's';
        document.getElementById('mass-vis').style.animationDuration = dur + 's';
    }


    // --- 4.0 æŒ¯å‹•æ¨¡æ“¬å™¨é‚è¼¯ ---
    let vibChart;
    
    // ç²å–å…ƒç´  (å¦‚æœå­˜åœ¨)
    const fopInput = document.getElementById('fop');
    const fnInput = document.getElementById('fn');
    const zetaInput = document.getElementById('zeta');
    const fopValDisplay = document.getElementById('fopVal');
    const fnValDisplay = document.getElementById('fnVal');
    const zetaValDisplay = document.getElementById('zetaVal');
    const rValDisplay = document.getElementById('rVal');
    const tValDisplay = document.getElementById('tVal');
    const apiStatusDisplay = document.getElementById('apiStatus');
    const statusMsg = document.getElementById('statusMessage');

    // å‚³éç‡å…¬å¼
    function calculateTransmissibility(r, zeta) {
        const num = 1 + Math.pow(2 * zeta * r, 2);
        const den = Math.pow(1 - Math.pow(r, 2), 2) + Math.pow(2 * zeta * r, 2);
        return Math.sqrt(num / den);
    }

    // æ›´æ–°æ¨¡æ“¬æ•¸æ“šèˆ‡åœ–è¡¨
    function updateSimulation() {
        if (!fopInput) return; 

        const fop = parseFloat(fopInput.value);
        const fn = parseFloat(fnInput.value);
        const zeta = parseFloat(zetaInput.value);
        const r = fop / fn;
        const T = calculateTransmissibility(r, zeta);

        // æ›´æ–°æ•¸æ“šé¡¯ç¤º
        fopValDisplay.textContent = fop;
        fnValDisplay.textContent = fn;
        zetaValDisplay.textContent = zeta.toFixed(2);
        rValDisplay.textContent = r.toFixed(2);
        tValDisplay.textContent = T.toFixed(2);

        // åˆ¤æ–·å€åŸŸèˆ‡ç‹€æ…‹
        let zoneColor = '';
        if (r <= 0.8) {
            apiStatusDisplay.textContent = "ç¬¦åˆ API (å‰›æ€§åŸºç¤)";
            apiStatusDisplay.style.color = "green";
            statusMsg.className = "status-safe";
            statusMsg.textContent = "âœ… å‰›æ€§å€åŸŸ (Rigid/Low-Tuned)ï¼šé »ç‡æ¯” < 0.8ã€‚é€™æ˜¯ Epoxy çŒæ¼¿çš„ç›®æ¨™å€åŸŸã€‚ç³»çµ±å‰›åº¦é«˜ï¼Œä½ç§»å°ï¼ŒæŒ¯å‹•ä¸æ”¾å¤§ã€‚";
            zoneColor = 'green';
        } else if (r >= 1.25) {
            if (r > 1.414) {
                apiStatusDisplay.textContent = "ç¬¦åˆ API (æœ‰æ•ˆéš”æŒ¯)";
                apiStatusDisplay.style.color = "#0c5460";
                statusMsg.className = "status-iso";
                statusMsg.textContent = "ğŸ”µ éš”æŒ¯å€åŸŸ (Isolation/High-Tuned)ï¼šé »ç‡æ¯” > 1.414ã€‚å‚³éç‡ < 1ï¼Œéœ‡å‹•è¢«æœ‰æ•ˆå¸æ”¶ï¼Œé©åˆå½ˆç°§/æ©¡è† å¢Šè¨­è¨ˆã€‚";
            } else {
                apiStatusDisplay.textContent = "ç¬¦åˆ API (é¿æŒ¯ä½†æœªå®Œå…¨éš”æŒ¯)";
                apiStatusDisplay.style.color = "#17a2b8";
                statusMsg.className = "status-iso";
                statusMsg.textContent = "âš ï¸ éæ¸¡å€åŸŸï¼šé »ç‡æ¯”åœ¨ 1.25 ~ 1.414 ä¹‹é–“ã€‚ç¬¦åˆ API é¿é–‹å…±æŒ¯è¦æ±‚ï¼Œä½†å°šæœªé”åˆ°ç†è«–éš”æŒ¯æ•ˆæœ (T < 1)ã€‚";
            }
            zoneColor = 'blue';
        } else {
            apiStatusDisplay.textContent = "âŒ é•å API (å…±æŒ¯é¢¨éšª)";
            apiStatusDisplay.style.color = "red";
            statusMsg.className = "status-danger";
            statusMsg.textContent = "ğŸ›‘ å…±æŒ¯å€åŸŸ (Resonance)ï¼šé »ç‡æ¯”åœ¨ 0.8 ~ 1.25 ä¹‹é–“ã€‚æŒ¯å‹•åŠ›è¢«æ”¾å¤§ï¼Œæ¥µå…·ç ´å£æ€§ã€‚æ‡‰è®Šæ›´è¨­è¨ˆï¼";
            zoneColor = 'red';
        }

        // é‡æ–°ç¹ªè£½åœ–è¡¨æ›²ç·š
        const curveData = [];
        for (let i = 0; i <= 300; i++) {
            let x = i / 100; // r å¾ 0 åˆ° 3
            curveData.push({x: x, y: calculateTransmissibility(x, zeta)});
        }

        if (vibChart) {
            vibChart.data.datasets[0].data = curveData;
            vibChart.data.datasets[1].data = [{x: r, y: T}];
            vibChart.data.datasets[1].backgroundColor = zoneColor;
            vibChart.data.datasets[1].borderColor = zoneColor;
            vibChart.update();
        }
    }

    // å¿«é€Ÿæƒ…å¢ƒè¨­å®š
    window.setScenario = function(type) {
        if (!fopInput) return;
        if (type === 'epoxy') {
            fopInput.value = 30; 
            fnInput.value = 60;  
            zetaInput.value = 0.05;
        } else if (type === 'isolation') {
            fopInput.value = 60; 
            fnInput.value = 20;  
            zetaInput.value = 0.05;
        } else if (type === 'resonance') {
            fopInput.value = 30;
            fnInput.value = 30;  
            zetaInput.value = 0.05;
        }
        updateSimulation();
    }

    // åˆå§‹åŒ– Chart.js åœ–è¡¨
    function initVibChart() {
        if (!document.getElementById('vibChart')) return;
        
        const ctx = document.getElementById('vibChart').getContext('2d');
        if (vibChart) vibChart.destroy(); // é¿å…é‡è¤‡åˆå§‹åŒ–
        
        vibChart = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'å‚³éç‡æ›²ç·š (Transmissibility)',
                        data: [],
                        showLine: true,
                        borderColor: '#888',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false,
                        tension: 0.4
                    },
                    {
                        label: 'ç›®å‰æ“ä½œé»',
                        data: [],
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        backgroundColor: 'green'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: { display: true, text: 'é »ç‡æ¯” r (f_op / f_n)' },
                        min: 0,
                        max: 3,
                        grid: { color: (context) => {
                            if (context.tick.value >= 0.79 && context.tick.value <= 0.81) return 'rgba(255, 0, 0, 0.5)'; 
                            if (context.tick.value >= 1.24 && context.tick.value <= 1.26) return 'rgba(255, 0, 0, 0.5)'; 
                            if (context.tick.value >= 1.41 && context.tick.value <= 1.42) return 'rgba(0, 0, 255, 0.5)'; 
                            return 'rgba(0,0,0,0.05)';
                        }}
                    },
                    y: {
                        title: { display: true, text: 'å‚³éç‡ T' },
                        min: 0,
                        max: 5,
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `r: ${context.parsed.x.toFixed(2)}, T: ${context.parsed.y.toFixed(2)}`;
                            }
                        }
                    }
                }
            }
        });

        // ç¶å®šäº‹ä»¶ç›£è½å™¨
        fopInput.addEventListener('input', updateSimulation);
        fnInput.addEventListener('input', updateSimulation);
        zetaInput.addEventListener('input', updateSimulation);
    }
    
    // --- æ‰‹é¢¨ç´å€å¡Šé‚è¼¯ ---
    const accordions = document.querySelectorAll('.accordion-item');
    accordions.forEach(item => {
        item.querySelector('.accordion-header').addEventListener('click', () => {
            const isActive = item.classList.contains('active');
            const isSectionFour = item.querySelector('.accordion-title').textContent.includes('å››ã€é€²éšè¨­è¨ˆï¼š');
            
            // é—œé–‰æ‰€æœ‰æ‰‹é¢¨ç´
            accordions.forEach(other => { 
                other.classList.remove('active'); 
                other.querySelector('.accordion-content').style.maxHeight = null; 
            });
            
            // é–‹å•Ÿè¢«é»æ“Šçš„æ‰‹é¢¨ç´
            if (!isActive) { 
                item.classList.add('active'); 
                const c = item.querySelector('.accordion-content'); 
                // å¢åŠ é«˜åº¦ä»¥å®¹ç´ Chart.js åœ–è¡¨
                c.style.maxHeight = c.scrollHeight + 500 + "px"; 
                
                // å¦‚æœæ˜¯ç¬¬å››éƒ¨åˆ†ï¼Œåˆå§‹åŒ–åœ–è¡¨
                if (isSectionFour) {
                    initVibChart();
                    updateSimulation();
                }
            }
        });
    });

    // --- åˆå§‹è¼‰å…¥è¨­å®š ---
    window.onload = function() {
        showState('flow');
        updateFreq();
        resetSimulation(); 

        // ç¢ºä¿åˆå§‹æ´»èºå€å¡Šçš„é«˜åº¦æ­£ç¢º
        const activeContents = document.querySelectorAll('.accordion-item.active .accordion-content');
        activeContents.forEach(ac => {
            ac.style.maxHeight = ac.scrollHeight + 500 + "px";
        });
        
        // å¦‚æœç¬¬å››éƒ¨åˆ†é è¨­ç‚º activeï¼Œå‰‡åˆå§‹åŒ–
        const sectionFour = document.querySelector('.accordion-item:nth-child(5)'); // Section 4 is the 5th accordion item (index 4)
        if (sectionFour && sectionFour.classList.contains('active')) {
             initVibChart();
             updateSimulation();
        }
    };
</script>
</body>
</html>